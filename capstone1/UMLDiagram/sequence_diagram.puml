@startuml SequenceDiagram
!theme vibrant
skinparam backgroundColor #f5f5f5
skinparam shadowing true

' Participant/Actor colors
skinparam actorBackgroundColor #81c784
skinparam actorBorderColor #388e3c
skinparam actorFontColor #ffffff

' Participant colors
skinparam participantBackgroundColor #64b5f6
skinparam participantBorderColor #1976d2
skinparam participantFontColor #ffffff

' Database colors
skinparam databaseBackgroundColor #ffb74d
skinparam databaseBorderColor #f57c00
skinparam databaseFontColor #ffffff

' Arrow colors
skinparam arrowColor #424242
skinparam arrowThickness 2

' Message styling
skinparam sequenceMessageAlign center
skinparam sequenceDividerBackgroundColor #e0e0e0
skinparam sequenceMessageFontSize 11
skinparam noteBackgroundColor #fff9c4
skinparam noteBorderColor #fbc02d
skinparam noteFontColor #333333

' Alt/Else styling
skinparam altBackgroundColor #ffe0b2
skinparam altBorderColor #ff6f00

title DasTern Sequence Diagram - Medication Reminder Flow

actor Patient as patient #81c784
participant "Mobile App" as app #64b5f6
participant "Camera" as camera #90caf9
participant "OCR Service" as ocr #ffb74d
participant "AI Engine" as ai #81c784
participant "Backend API" as backend #4fc3f7
database "Local Storage" as db #ffb74d
participant "Scheduler" as scheduler #7e57c2
participant "Telegram Bot" as telegram #26c6da
' actor "Family" as family #ff7043

== Prescription Scanning ==

box #c8e6c9
participant "Mobile App" as app
participant "Camera" as camera
participant "OCR Service" as ocr
end box
patient -> app: Open Scan
activate app
app -> camera: Launch camera
activate camera
camera --> app: Ready
patient -> camera: Capture image
camera --> app: Return image
deactivate camera

app -> ocr: Send image
activate ocr
ocr --> app: Extract text
deactivate ocr

== Text Enhancement ==

box #bbdefb
participant "AI Engine" as ai
end box
app -> ai: Send OCR text
activate ai
ai --> app: Structured data
deactivate ai
app --> patient: Display results
patient -> app: Confirm/Edit

== Schedule Setup ==

box #e1bee7
end box
app -> patient: Enter meal times
patient -> app: Provide times

== Reminder Generation ==

box #ffe0b2
participant "Backend API" as backend
participant "Scheduler" as scheduler
database "Local Storage" as db
end box
app -> backend: Send medication + times
activate backend
backend -> db: Store schedule
activate db
db --> backend: Saved
deactivate db
backend --> app: Return schedule
deactivate backend

app -> scheduler: Register reminders
activate scheduler
scheduler --> app: Scheduled
deactivate scheduler

== Notifications ==

box #f8bbd0
participant "Telegram Bot" as telegram
end box
scheduler -> app: Trigger reminder
activate app
app -> app: Show notification
app --> patient: Display reminder

alt Family monitoring enabled
    app -> telegram: Send notification
    activate telegram
    telegram -> family: Alert
    deactivate telegram
end

patient -> app: Mark taken/missed

alt Medication taken
    app -> db: Log taken
    activate db
    db --> app: Updated
    deactivate db
else Medication missed
    app -> db: Log missed
    activate db
    db --> app: Updated
    deactivate db
    
    alt Family alert enabled
        app -> telegram: Alert family
        activate telegram
        telegram -> family: ⚠️ Missed dose
        deactivate telegram
    end
end

deactivate app
deactivate scheduler

== History View ==

box #b2dfdb
end box
patient -> app: Open history
activate app
app -> db: Fetch records
activate db
db --> app: Return data
deactivate db
app --> patient: Display history
deactivate app

@enduml





















' @startuml SequenceDiagram'
' !theme vibrant
' skinparam backgroundColor #f5f5f5
' skinparam shadowing true

' ' Participant/Actor colors
' skinparam actorBackgroundColor #81c784
' skinparam actorBorderColor #388e3c
' skinparam actorFontColor #ffffff

' ' Participant colors
' skinparam participantBackgroundColor #64b5f6
' skinparam participantBorderColor #1976d2
' skinparam participantFontColor #ffffff

' ' Database colors
' skinparam databaseBackgroundColor #ffb74d
' skinparam databaseBorderColor #f57c00
' skinparam databaseFontColor #ffffff

' ' Arrow colors
' skinparam arrowColor #424242
' skinparam arrowThickness 2

' ' Message styling
' skinparam sequenceMessageAlign center
' skinparam sequenceDividerBackgroundColor #e0e0e0
' skinparam sequenceMessageFontSize 11
' skinparam noteBackgroundColor #fff9c4
' skinparam noteBorderColor #fbc02d
' skinparam noteFontColor #333333

' ' Alt/Else styling
' skinparam altBackgroundColor #ffe0b2
' skinparam altBorderColor #ff6f00

' title DasTern Sequence Diagram - Medication Reminder Flow

' actor Patient as patient #81c784
' participant "Mobile App" as app #64b5f6
' participant "Camera" as camera #90caf9
' participant "OCR Service" as ocr #ffb74d
' participant "AI Engine" as ai #81c784
' participant "Backend API" as backend #4fc3f7
' database "Local Storage" as db #ffb74d
' participant "Scheduler" as scheduler #7e57c2
' participant "Telegram Bot" as telegram #26c6da
' actor "Family" as family #ff7043

' == Prescription Scanning ==

' box #e8f5e9
' patient -> app: Open Scan
' activate app
' app -> camera: Launch camera
' activate camera
' camera --> app: Ready
' patient -> camera: Capture image
' camera --> app: Return image
' deactivate camera

' app -> ocr: Send image
' activate ocr
' ocr --> app: Extract text
' deactivate ocr
' end box

' == Text Enhancement ==

' box #bbdefb
' app -> ai: Send OCR text
' activate ai
' ai --> app: Structured data
' deactivate ai
' app --> patient: Display results
' patient -> app: Confirm/Edit
' end box

' == Schedule Setup ==

' box #f3e5f5
' app -> patient: Enter meal times
' patient -> app: Provide times
' end box

' == Reminder Generation ==

' box #fff3e0
' app -> backend: Send medication + times
' activate backend
' backend -> db: Store schedule
' activate db
' db --> backend: Saved
' deactivate db
' backend --> app: Return schedule
' deactivate backend

' app -> scheduler: Register reminders
' activate scheduler
' scheduler --> app: Scheduled
' deactivate scheduler
' end box

' == Notifications ==

' box #fce4ec
' scheduler -> app: Trigger reminder
' activate app
' app -> app: Show notification
' app --> patient: Display reminder

' alt Family monitoring enabled
'     app -> telegram: Send notification
'     activate telegram
'     telegram -> family: Alert
'     deactivate telegram
' end

' patient -> app: Mark taken/missed

' alt Medication taken
'     app -> db: Log taken
'     activate db
'     db --> app: Updated
'     deactivate db
' else Medication missed
'     app -> db: Log missed
'     activate db
'     db --> app: Updated
'     deactivate db
    
'     alt Family alert enabled
'         app -> telegram: Alert family
'         activate telegram
'         telegram -> family: ⚠️ Missed dose
'         deactivate telegram
'     end
' end

' deactivate app
' deactivate scheduler
' end box

' == History View ==

' box #e0f2f1
' patient -> app: Open history
' activate app
' app -> db: Fetch records
' activate db
' db --> app: Return data
' deactivate db
' app --> patient: Display history
' deactivate app
' end box

' @enduml
